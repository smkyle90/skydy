
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>skydy.rigidbody.Body &#8212; SkyDy 0.0.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for skydy.rigidbody.Body</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sym</span>

<span class="kn">from</span> <span class="nn">..configuration</span> <span class="kn">import</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">DimensionSymbols</span>
<span class="kn">from</span> <span class="nn">..inertia</span> <span class="kn">import</span> <span class="n">InertiaMatrix</span><span class="p">,</span> <span class="n">MassMatrix</span>
<span class="kn">from</span> <span class="nn">..output</span> <span class="kn">import</span> <span class="n">Arrow3D</span>
<span class="kn">from</span> <span class="nn">.BodyCoordinate</span> <span class="kn">import</span> <span class="n">BodyCoordinate</span>
<span class="kn">from</span> <span class="nn">.BodyForce</span> <span class="kn">import</span> <span class="n">BodyForce</span><span class="p">,</span> <span class="n">BodyTorque</span>

<span class="n">GROUND_NAME</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>


<div class="viewcode-block" id="Body"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Body">[docs]</a><span class="k">class</span> <span class="nc">Body</span><span class="p">(</span><span class="n">Configuration</span><span class="p">):</span>
    <span class="n">id_counter</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="Body.__init__"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Body.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A Body is a collection of particles. It has a mass, and some dimensions</span>
<span class="sd">        (length, width and height), and by default has six degrees of freedom (DOFs).</span>
<span class="sd">        As such, it extends the Configuration class, with the addition of the inertial</span>
<span class="sd">        properties (InertiaMatrix and MassMatrix) and some dimensions (DimensionSymbols).</span>

<span class="sd">        We also instantite two empty lists for the forces and torques that *might* be</span>
<span class="sd">        applied to the body.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (int, float or string): the name of the body.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; from skydy.rigidbody import Body</span>
<span class="sd">            &gt;&gt;&gt; # Empty initializer</span>
<span class="sd">            &gt;&gt;&gt; b_1 = Body()</span>
<span class="sd">            &gt;&gt;&gt; # Define name by a number</span>
<span class="sd">            &gt;&gt;&gt; b_2 = Body(2)</span>
<span class="sd">            &gt;&gt;&gt; # Empty initializer</span>
<span class="sd">            &gt;&gt;&gt; b_3 = Body(&quot;car&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Body accounting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_id</span> <span class="o">=</span> <span class="n">Body</span><span class="o">.</span><span class="n">id_counter</span>
        <span class="n">Body</span><span class="o">.</span><span class="n">id_counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Initialise the Configuration object</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Inertial Properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix</span> <span class="o">=</span> <span class="n">MassMatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inertia_matrix</span> <span class="o">=</span> <span class="n">InertiaMatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">linear_forces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_torques</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="n">DimensionSymbols</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Body.body_twists"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Body.body_twists">[docs]</a>    <span class="k">def</span> <span class="nf">body_twists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the body twists to ultimately determine the</span>
<span class="sd">        translational and rotational velocities.</span>


<span class="sd">        omega is the body rotational velocity.</span>
<span class="sd">        v_body is the body translational velocity.</span>

<span class="sd">        Mathematical expressions are:</span>

<span class="sd">        Let r \\in R^3 be the position of the COM, and R \\in SO(3) the body orientation.</span>

<span class="sd">        Then,</span>

<span class="sd">            omega_hat = R^(-1) @ (d/dt) R,</span>
<span class="sd">            omega = unhat_map(omega_hat),</span>
<span class="sd">            v_body = (d/dt) r.</span>

<span class="sd">        Refer to Bullo and Lewis for more information.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            v_body (sympy.matrix): the body translational velocities</span>
<span class="sd">            omega_body (sympy.matrix): the body rotational velocities</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the rotational velocity</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot_body</span><span class="o">.</span><span class="n">inv</span><span class="p">()</span> <span class="o">@</span> <span class="n">sym</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rot_body</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">))</span>

        <span class="n">omega_body</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">omega</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">omega</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

        <span class="c1"># Define the position of COM and get velocity</span>
        <span class="n">v_body</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_body</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">v_body</span><span class="p">),</span> <span class="n">sym</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">omega_body</span><span class="p">)</span></div>

<div class="viewcode-block" id="Body.kinetic_energy"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Body.kinetic_energy">[docs]</a>    <span class="k">def</span> <span class="nf">kinetic_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the kinetic energy of the body.</span>

<span class="sd">        Let v_body \\in R^3, w_body \\in R^3 be the translational and rotational velocities,</span>
<span class="sd">        M \\in R^(3x3), I \\in R^(3x3) be the mass and inertia matrices, then,</span>

<span class="sd">            KE_trans = (1/2) * v_vody^(T) @ M @ v_body</span>
<span class="sd">            KE_rot = (1/2) * w_vody^(T) @ I @ w_body</span>

<span class="sd">            KE_tot = KE_trans + KE_rot.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            KE_tot (sympy.symbol): the symbol expression of the kinetic energy.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Define the kinetic energy of the system</span>
        <span class="n">v_body</span><span class="p">,</span> <span class="n">w_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_twists</span><span class="p">()</span>
        <span class="n">KE_tr</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">v_body</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix</span><span class="o">.</span><span class="n">as_mat</span><span class="p">()</span> <span class="o">@</span> <span class="n">v_body</span>
        <span class="n">KE_ro</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">w_body</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">inertia_matrix</span><span class="o">.</span><span class="n">as_mat</span><span class="p">()</span> <span class="o">@</span> <span class="n">w_body</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">KE_tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">KE_ro</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Body.potential_energy"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Body.potential_energy">[docs]</a>    <span class="k">def</span> <span class="nf">potential_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gravity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the potential energy of the body.</span>

<span class="sd">        The PE is the component of the position of the body in the z-coordinate (height), times</span>
<span class="sd">        gravity (g), times mass, i.e.,</span>

<span class="sd">            PE = m * dot(g, r)</span>

<span class="sd">        Args:</span>
<span class="sd">            gravity (sympy.matrix): the gravity vector in the global coordinte frame, typically [0, 0, g]</span>

<span class="sd">        Returns:</span>
<span class="sd">            potential_energy (sympy.symbols): the symbol expression of the potential energy</span>

<span class="sd">        Examples:</span>

<span class="sd">            &gt;&gt;&gt; from skydy.rigidbody import Body</span>
<span class="sd">            &gt;&gt;&gt; b = Body()</span>
<span class="sd">            &gt;&gt;&gt; # Define the gravity vector</span>
<span class="sd">            &gt;&gt;&gt; g = sym.Matrix([0, 0, sym.Symbol(&#39;g&#39;)])</span>
<span class="sd">            &gt;&gt;&gt; # Calculate the potential energy</span>
<span class="sd">            &gt;&gt;&gt; b.potential_energy(g)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix</span><span class="o">.</span><span class="n">as_mat</span><span class="p">()[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_body</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gravity</span><span class="p">)</span></div>

<div class="viewcode-block" id="Body.add_force"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Body.add_force">[docs]</a>    <span class="k">def</span> <span class="nf">add_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_vector</span><span class="p">,</span> <span class="n">force_location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add, or apply a force to the body. For a force to</span>
<span class="sd">        do anything, the force must have a direction AND a location.</span>

<span class="sd">        Args:</span>
<span class="sd">            force_vector (BodyForce): the force direction, as defined in the body&#39;s coordinate frame.</span>
<span class="sd">            force_location (BodyCoordinate): the location of the force, as define in the body&#39;s coordinate frame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Examples:</span>

<span class="sd">            &gt;&gt;&gt; from skydy.Body import Body, BodyForce, BodyCoordinate</span>
<span class="sd">            &gt;&gt;&gt; # Define the body</span>
<span class="sd">            &gt;&gt;&gt; b = Body()</span>
<span class="sd">            &gt;&gt;&gt; # Apply a force in the x-direction</span>
<span class="sd">            &gt;&gt;&gt; f_1 = BodyForce(&quot;1&quot;, x_dir=True)</span>
<span class="sd">            &gt;&gt;&gt; # Apply the force at the origin of the Body</span>
<span class="sd">            &gt;&gt;&gt; f_loc = BodyCoordinate(&quot;PF1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; # We can now apply the force</span>
<span class="sd">            &gt;&gt;&gt; b.apply_force(f_1, f_loc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">force_vector</span><span class="p">,</span> <span class="n">BodyForce</span>
        <span class="p">),</span> <span class="s2">&quot;Force Vector Must be a BodyForce object.&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">force_location</span><span class="p">,</span> <span class="n">BodyCoordinate</span>
        <span class="p">),</span> <span class="s2">&quot;Force Location Must be a BodyCoordinate object.&quot;</span>
        <span class="n">linear_force</span> <span class="o">=</span> <span class="p">(</span><span class="n">force_vector</span><span class="p">,</span> <span class="n">force_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_forces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_force</span><span class="p">)</span></div>

<div class="viewcode-block" id="Body.add_torque"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Body.add_torque">[docs]</a>    <span class="k">def</span> <span class="nf">add_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">torque_vector</span><span class="p">,</span> <span class="n">torque_location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add, or apply a torque to the body. For a torque to f</span>
<span class="sd">        do anything, the torque must have a direction AND a location.</span>

<span class="sd">        Args:</span>
<span class="sd">            torque_vector (BodyTorque): the torque direction, as defined in the body&#39;s coordinate frame.</span>
<span class="sd">            torque_location (BodyCoordinate): the location of the torque, as define in the body&#39;s coordinate frame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Examples:</span>

<span class="sd">            &gt;&gt;&gt; from skydy.Body import Body, BodyTorque, BodyCoordinate</span>
<span class="sd">            &gt;&gt;&gt; # Define the body</span>
<span class="sd">            &gt;&gt;&gt; b = Body()</span>
<span class="sd">            &gt;&gt;&gt; # Apply a torque in the x-direction</span>
<span class="sd">            &gt;&gt;&gt; t_1 = BodyTorque(&quot;1&quot;, x_dir=True)</span>
<span class="sd">            &gt;&gt;&gt; # Apply the torque at the origin of the Body</span>
<span class="sd">            &gt;&gt;&gt; t_loc = BodyCoordinate(&quot;PT1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; # We can now apply the torque</span>
<span class="sd">            &gt;&gt;&gt; b.apply_torque(t_1, t_loc)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">torque_vector</span><span class="p">,</span> <span class="n">BodyTorque</span>
        <span class="p">),</span> <span class="s2">&quot;Torque Vector Must be a BodyTorque object.&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">torque_location</span><span class="p">,</span> <span class="n">BodyCoordinate</span>
        <span class="p">),</span> <span class="s2">&quot;Torque Location Must be a BodyCoordinate object.&quot;</span>
        <span class="n">linear_torque</span> <span class="o">=</span> <span class="p">(</span><span class="n">torque_vector</span><span class="p">,</span> <span class="n">torque_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_torques</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linear_torque</span><span class="p">)</span></div>

<div class="viewcode-block" id="Body.draw"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Body.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_body</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_joint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the body.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax (matplotlib.axes._subplots.AxesSubplot): the axis to plot the connection on.</span>
<span class="sd">            ref_body (None or Body): the reference Body to propagate dimensions, coordinates etc.</span>
<span class="sd">            ref_joint (None or numpy.ndarray): the location of the joint the body is connected to.</span>
<span class="sd">            sub_vals (dict): symbol-value pairs required to go from symbolic to numeric expression. It is important to note, that all symbols each body is dependent on, for example, for upstream bodies and joints, are included.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ax (matplotlib.axes._subplots.AxesSubplot): updated axes, with plots.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from skydy.rigidbody import Body</span>
<span class="sd">            &gt;&gt;&gt; # Define the body</span>
<span class="sd">            &gt;&gt;&gt; b = Body()</span>
<span class="sd">            &gt;&gt;&gt; # Define the axes</span>
<span class="sd">            &gt;&gt;&gt; fig = plt.figure()</span>
<span class="sd">            &gt;&gt;&gt; ax = fig.add_subplot(111, projection=&#39;3d&#39;)</span>
<span class="sd">            &gt;&gt;&gt; ax = b.draw(ax)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ref_body</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ref_body</span> <span class="o">=</span> <span class="n">Ground</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ref_joint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ref_joint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">sub_vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sub_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>

        <span class="c1"># Make copies of the symbols position, rotation and origins</span>
        <span class="n">body_rot_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot_body</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">half_rot_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot_body</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">body_pos_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_body</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ref_body_origin</span> <span class="o">=</span> <span class="n">ref_body</span><span class="o">.</span><span class="n">pos_body</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Sub in numeric values</span>
        <span class="n">body_pos_mat</span> <span class="o">=</span> <span class="n">body_pos_mat</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub_vals</span><span class="p">)</span>
        <span class="n">body_rot_mat</span> <span class="o">=</span> <span class="n">body_rot_mat</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub_vals</span><span class="p">)</span>
        <span class="n">ref_body_origin</span> <span class="o">=</span> <span class="n">ref_body_origin</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub_vals</span><span class="p">)</span>

        <span class="c1"># for the half rot, we want to only rotate THIS body&#39;s</span>
        <span class="c1"># values by half. This is used for plotting the angle symbols</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sub_vals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">():</span>
                <span class="n">half_rot_mat</span> <span class="o">=</span> <span class="n">half_rot_mat</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">half_rot_mat</span> <span class="o">=</span> <span class="n">half_rot_mat</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="c1"># Convert to numpy array</span>
        <span class="n">body_pos_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_to_np</span><span class="p">(</span><span class="n">body_pos_mat</span><span class="p">)</span>
        <span class="n">body_rot_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_to_np</span><span class="p">(</span><span class="n">body_rot_mat</span><span class="p">)</span>
        <span class="n">ref_body_origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_to_np</span><span class="p">(</span><span class="n">ref_body_origin</span><span class="p">)</span>
        <span class="n">half_rot_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_to_np</span><span class="p">(</span><span class="n">half_rot_mat</span><span class="p">)</span>

        <span class="c1"># Plot principal axes and the free rotation angles</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_body_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">body_pos_mat</span><span class="p">,</span> <span class="n">body_rot_mat</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_free_angles</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ref_joint</span><span class="p">,</span> <span class="n">half_rot_mat</span><span class="p">)</span>

        <span class="c1"># Dimension plotting</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_body_geometry</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">body_pos_mat</span><span class="p">,</span> <span class="n">body_rot_mat</span><span class="p">)</span>

        <span class="c1"># Plot the COM</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_COM</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">body_pos_mat</span><span class="p">,</span> <span class="n">ref_body_origin</span><span class="p">,</span> <span class="n">ref_body</span><span class="p">)</span>

        <span class="c1"># Plot the forces</span>
        <span class="k">for</span> <span class="n">force</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_forces</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_input</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">force</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">body_pos_mat</span><span class="p">,</span> <span class="n">body_rot_mat</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">torque</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_torques</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_input</span><span class="p">(</span>
                <span class="n">ax</span><span class="p">,</span> <span class="n">torque</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">body_pos_mat</span><span class="p">,</span> <span class="n">body_rot_mat</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">tau&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div>

    <span class="k">def</span> <span class="nf">__plot_COM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">pos_ref</span><span class="p">,</span> <span class="n">ref_origin</span><span class="p">,</span> <span class="n">ref_body</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the COM of the body.&quot;&quot;&quot;</span>
        <span class="c1"># Plot the COM</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span><span class="n">pos_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pos_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pos_ref</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">pos_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="n">pos_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="n">pos_ref</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="s2">&quot;$G_{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}$&quot;</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;x-small&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__draw_3d_line</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ref_origin</span><span class="p">,</span> <span class="n">pos_ref</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># plot the vector from the base COM to this body&#39;s COM</span>
        <span class="c1"># ax.plot3D(*np.hstack((ref_origin, pos_ref)).tolist(), c=&quot;k&quot;, linewidth=0.5)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="p">(</span><span class="n">pos_ref</span> <span class="o">+</span> <span class="n">ref_origin</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="n">pos_ref</span> <span class="o">+</span> <span class="n">ref_origin</span><span class="p">)[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="n">pos_ref</span> <span class="o">+</span> <span class="n">ref_origin</span><span class="p">)[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">symbols_to_latex</span><span class="p">(</span>
                <span class="n">sym</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_body</span> <span class="o">-</span> <span class="n">ref_body</span><span class="o">.</span><span class="n">pos_body</span><span class="p">),</span>
                <span class="s2">&quot;p^{G_{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_body</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}}_{G_{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}}&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;x-small&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__plot_body_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">pos_ref</span><span class="p">,</span> <span class="n">rot_ref</span><span class="p">,</span> <span class="n">scale_by</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the body axes.&quot;&quot;&quot;</span>
        <span class="c1"># Plot the principal axes</span>
        <span class="n">body_dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># plot the positive and negative vectors</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">rot_body_axes</span> <span class="o">=</span> <span class="n">pos_ref</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">scale_by</span> <span class="o">*</span> <span class="n">rot_ref</span> <span class="o">@</span> <span class="n">body_dims</span>
            <span class="k">for</span> <span class="n">axes</span> <span class="ow">in</span> <span class="n">rot_body_axes</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__draw_3d_line</span><span class="p">(</span>
                    <span class="n">ax</span><span class="p">,</span> <span class="n">pos_ref</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__plot_free_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ref_joint</span><span class="p">,</span> <span class="n">half_rot_mat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the free angles.&quot;&quot;&quot;</span>
        <span class="n">n_coords</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_coords</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="n">n_coords</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_idx</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># A rotation about x-coordinate is plotted as a rotation of</span>
            <span class="c1"># either the y- or z-axis, etc. As such we need to rotate and plot</span>
            <span class="c1"># the angle about the i-th axis as a vector abot the i+2-th basis vector.</span>
            <span class="n">base_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_coords</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">base_vector</span><span class="p">[(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_coords</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">rot_ax</span> <span class="o">=</span> <span class="n">ref_joint</span> <span class="o">+</span> <span class="n">half_rot_mat</span> <span class="o">@</span> <span class="n">base_vector</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="o">*</span><span class="n">rot_ax</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">symbols_to_latex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">()[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]),</span>
                <span class="n">c</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;x-small&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__plot_body_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">pos_ref</span><span class="p">,</span> <span class="n">rot_ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the body geometry.&quot;&quot;&quot;</span>
        <span class="n">body_corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_body_corners</span><span class="p">()</span>

        <span class="c1"># Move translate and rotate corners into global frame</span>
        <span class="n">rot_body_corners</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_ref</span> <span class="o">+</span> <span class="n">rot_ref</span> <span class="o">@</span> <span class="n">body_corners</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># Plot the body corners</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span>
            <span class="n">rot_body_corners</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">rot_body_corners</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">rot_body_corners</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="n">c</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># label the dimensions of the body</span>
        <span class="c1"># from the 0th index in the body corners,</span>
        <span class="c1"># the:</span>
        <span class="c1">#   - l is a vector from the 0th index to the 2nd index,</span>
        <span class="c1">#   - w is a vector from the 0th index to the 4th index,</span>
        <span class="c1">#   - h is a vector from the 0th index to the 1st index.</span>
        <span class="n">dim_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dim_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="o">.</span><span class="n">symbols</span><span class="p">()):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">symbol</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">v_start</span> <span class="o">=</span> <span class="n">rot_body_corners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">v_end</span> <span class="o">=</span> <span class="n">rot_body_corners</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__draw_3d_line</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">v_start</span><span class="p">,</span> <span class="n">v_end</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">v_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">v_start</span><span class="p">,</span> <span class="n">v_end</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="o">*</span><span class="n">v_dim</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">symbols_to_latex</span><span class="p">(</span><span class="n">symbol</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;x-small&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Fill in the rest of the body (start_vertex, end_vertex)</span>
        <span class="n">rest_of_body</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">s_idx</span><span class="p">,</span> <span class="n">e_idx</span> <span class="ow">in</span> <span class="n">rest_of_body</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__draw_3d_line</span><span class="p">(</span>
                <span class="n">ax</span><span class="p">,</span> <span class="n">rot_body_corners</span><span class="p">[</span><span class="n">s_idx</span><span class="p">],</span> <span class="n">rot_body_corners</span><span class="p">[</span><span class="n">e_idx</span><span class="p">],</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="mf">0.5</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__get_body_corners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the location of the corners based on the body geometry.&quot;&quot;&quot;</span>
        <span class="c1"># Get body dimensions</span>
        <span class="n">l</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="c1"># get all the combinations of body_corners as a np array</span>
        <span class="n">body_corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
                <span class="p">[</span><span class="o">-</span><span class="n">l</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="n">w</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">body_corners</span>

    <span class="k">def</span> <span class="nf">__plot_input</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">input_obj</span><span class="p">,</span> <span class="n">input_loc</span><span class="p">,</span> <span class="n">pos_ref</span><span class="p">,</span> <span class="n">rot_ref</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">name_prefix</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot an input in the direction of the input, at the location of the input.&quot;&quot;&quot;</span>
        <span class="n">input_val</span> <span class="o">=</span> <span class="n">input_obj</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">loc_val</span> <span class="o">=</span> <span class="n">input_loc</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="n">input_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_to_np</span><span class="p">(</span><span class="n">input_val</span><span class="p">)</span>
        <span class="n">input_val</span> <span class="o">=</span> <span class="n">rot_ref</span> <span class="o">@</span> <span class="n">input_val</span>

        <span class="n">loc_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_to_np</span><span class="p">(</span><span class="n">loc_val</span><span class="p">)</span>
        <span class="n">loc_val</span> <span class="o">=</span> <span class="n">pos_ref</span> <span class="o">+</span> <span class="n">rot_ref</span> <span class="o">@</span> <span class="n">loc_val</span>

        <span class="c1"># Start and end vectors for arrow</span>
        <span class="n">v_start</span> <span class="o">=</span> <span class="n">loc_val</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">v_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_val</span> <span class="o">+</span> <span class="n">loc_val</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">v_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">v_start</span><span class="p">,</span> <span class="n">v_end</span><span class="p">))</span>

        <span class="c1"># Plot the arrow and add the label</span>
        <span class="n">arrow</span> <span class="o">=</span> <span class="n">Arrow3D</span><span class="p">(</span>
            <span class="o">*</span><span class="n">v_vec</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="o">*</span><span class="n">v_end</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">name_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">input_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;x-small&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__draw_3d_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw a line from p1 to p2.&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">p_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">))</span>

        <span class="c1"># plot the vector from the base COM to this body&#39;s COM</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="o">*</span><span class="n">p_vec</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="Ground"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Ground">[docs]</a><span class="k">class</span> <span class="nc">Ground</span><span class="p">(</span><span class="n">Body</span><span class="p">):</span>
<div class="viewcode-block" id="Ground.__init__"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.Ground.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The base Body for every system.</span>

<span class="sd">        The Ground defines the global coordinate frame, that cannot move or rotate.</span>
<span class="sd">        All coordinates are constrained, with zero constant value.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; from skydy.rigidbody import Ground</span>
<span class="sd">            &gt;&gt;&gt; b_gnd = Ground()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">GROUND_NAME</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pos_body</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_body</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_constraint</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="o">.</span><span class="n">assign_values</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="symbols_to_latex"><a class="viewcode-back" href="../../../skydy.rigidbody.html#skydy.rigidbody.Body.symbols_to_latex">[docs]</a><span class="k">def</span> <span class="nf">symbols_to_latex</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert symbols to latex.</span>

<span class="sd">    Args:</span>
<span class="sd">        symbols (sympy.matrix or sympy.Symbol): a list of symbols or symbol.</span>
<span class="sd">        prefix (str): an &quot;equals&quot; prefix.</span>

<span class="sd">    Returns:</span>
<span class="sd">        latex_str (str): sympy object turned into a latex-able string.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">lat_str</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">printing</span><span class="o">.</span><span class="n">vlatex</span><span class="p">(</span>
            <span class="n">symbols</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;inline&quot;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">lat_str</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">printing</span><span class="o">.</span><span class="n">vlatex</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;inline&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lat_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> = &quot;</span> <span class="o">+</span> <span class="n">lat_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">SkyDy</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../skydy.html">skydy package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Scott M. Kyle.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>